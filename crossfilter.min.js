(function(r){function n(r){return r}function t(r,n){for(var t=0,e=n.length,u=Array(e);e>t;++t)u[t]=r[n[t]];return u}function e(r){function n(n,t,e,u){for(;u>e;){var o=e+u>>>1;r(n[o])<t?e=o+1:u=o}return e}function t(n,t,e,u){for(;u>e;){var o=e+u>>>1;t<r(n[o])?u=o:e=o+1}return e}return t.right=t,t.left=n,t}function u(r){function n(r,n,t){for(var u=t-n,o=(u>>>1)+1;--o>0;)e(r,o,u,n);return r}function t(r,n,t){for(var u,o=t-n;--o>0;)u=r[n],r[n]=r[n+o],r[n+o]=u,e(r,1,o,n);return r}function e(n,t,e,u){for(var o,f=n[--u+t],i=r(f);(o=t<<1)<=e&&(e>o&&r(n[u+o])>r(n[u+o+1])&&o++,!(i<=r(n[u+o])));)n[u+t]=n[u+o],t=o;n[u+t]=f}return n.sort=t,n}function o(r){function n(n,e,u,o){var f,i,a,c,s=Array(o=Math.min(u-e,o));for(i=0;o>i;++i)s[i]=n[e++];if(t(s,0,o),u>e){f=r(s[0]);do(a=r(c=n[e])>f)&&(s[0]=c,f=r(t(s,0,o)[0]));while(++e<u)}return s}var t=u(r);return n}function f(r){function n(n,t,e){for(var u=t+1;e>u;++u){for(var o=u,f=n[u],i=r(f);o>t&&r(n[o-1])>i;--o)n[o]=n[o-1];n[o]=f}return n}return n}function i(r){function n(r,n,u){return(U>u-n?e:t)(r,n,u)}function t(t,e,u){var o,f=0|(u-e)/6,i=e+f,a=u-1-f,c=e+u-1>>1,s=c-f,l=c+f,v=t[i],h=r(v),p=t[s],y=r(p),d=t[c],g=r(d),b=t[l],m=r(b),x=t[a],k=r(x);h>y&&(o=v,v=p,p=o,o=h,h=y,y=o),m>k&&(o=b,b=x,x=o,o=m,m=k,k=o),h>g&&(o=v,v=d,d=o,o=h,h=g,g=o),y>g&&(o=p,p=d,d=o,o=y,y=g,g=o),h>m&&(o=v,v=b,b=o,o=h,h=m,m=o),g>m&&(o=d,d=b,b=o,o=g,g=m,m=o),y>k&&(o=p,p=x,x=o,o=y,y=k,k=o),y>g&&(o=p,p=d,d=o,o=y,y=g,g=o),m>k&&(o=b,b=x,x=o,o=m,m=k,k=o);var E=p,z=y,A=b,w=m;t[i]=v,t[s]=t[e],t[c]=d,t[l]=t[u-1],t[a]=x;var O=e+1,M=u-2,U=w>=z&&z>=w;if(U)for(var N=O;M>=N;++N){var C=t[N],S=r(C);if(z>S)N!==O&&(t[N]=t[O],t[O]=C),++O;else if(S>z)for(;;){var q=r(t[M]);{if(!(q>z)){if(z>q){t[N]=t[O],t[O++]=t[M],t[M--]=C;break}t[N]=t[M],t[M--]=C;break}M--}}}else for(var N=O;M>=N;N++){var C=t[N],S=r(C);if(z>S)N!==O&&(t[N]=t[O],t[O]=C),++O;else if(S>w)for(;;){var q=r(t[M]);{if(!(q>w)){z>q?(t[N]=t[O],t[O++]=t[M],t[M--]=C):(t[N]=t[M],t[M--]=C);break}if(M--,N>M)break}}}if(t[e]=t[O-1],t[O-1]=E,t[u-1]=t[M+1],t[M+1]=A,n(t,e,O-1),n(t,M+2,u),U)return t;if(i>O&&M>a){for(var F,q;(F=r(t[O]))<=z&&F>=z;)++O;for(;(q=r(t[M]))<=w&&q>=w;)--M;for(var N=O;M>=N;N++){var C=t[N],S=r(C);if(z>=S&&S>=z)N!==O&&(t[N]=t[O],t[O]=C),O++;else if(w>=S&&S>=w)for(;;){var q=r(t[M]);{if(!(w>=q&&q>=w)){z>q?(t[N]=t[O],t[O++]=t[M],t[M--]=C):(t[N]=t[M],t[M--]=C);break}if(M--,N>M)break}}}}return n(t,O,M+1)}var e=f(r);return n}function a(r){return Array(r)}function c(r){this.length=r,this.subarrays=1,this.width=8,this.masks={0:0},this[0]=N(r)}function s(r,n){return function(t){var e=t.length;return[r.left(t,n,0,e),r.right(t,n,0,e)]}}function l(r,n){var t=n[0],e=n[1];return function(n){var u=n.length;return[r.left(n,t,0,u),r.left(n,e,0,u)]}}function v(r){return[0,r.length]}function h(){return null}function p(){return 0}function y(r){return r+1}function d(r){return r-1}function g(r){return function(n,t){return n+ +r(t)}}function b(r){return function(n,t){return n-r(t)}}function m(){function r(r){var n=O,t=r.length;return t&&(w=w.concat(r),m.lengthen(O+=t),U.forEach(function(e){e(r,n,t)})),A}function e(r){function e(n,e,u){Q=n.map(r),T=X(k(u),0,u),Q=t(Q,T);var o,f,i=Y(Q),a=i[0],c=i[1];if(V)for(o=0;u>o;++o)V(Q[o],f=T[o]+e)||(m[K][f]|=I);else{for(o=0;a>o;++o)m[K][T[o]+e]|=I;for(o=c;u>o;++o)m[K][T[o]+e]|=I}if(!e)return L=Q,P=T,_=a,rn=c,void 0;var s=L,l=P,v=0,h=0;for(L=Array(O),P=x(O,O),o=0;e>v&&u>h;++o)s[v]<Q[h]?(L[o]=s[v],P[o]=l[v++]):(L[o]=Q[h],P[o]=T[h++]+e);for(;e>v;++v,++o)L[o]=s[v],P[o]=l[v];for(;u>h;++h,++o)L[o]=Q[h],P[o]=T[h]+e;i=Y(L),_=i[0],rn=i[1]}function f(r,n,t){Z.forEach(function(r){r(Q,T,n,t)}),Q=T=null}function a(r){var n=r[0],t=r[1];if(V)return V=null,R(function(r,e){return e>=n&&t>e}),_=n,rn=t,W;var e,u,o,f=[],i=[];if(_>n)for(e=n,u=Math.min(_,t);u>e;++e)m[K][o=P[e]]^=I,f.push(o);else if(n>_)for(e=_,u=Math.min(n,rn);u>e;++e)m[K][o=P[e]]^=I,i.push(o);if(t>rn)for(e=Math.max(n,rn),u=t;u>e;++e)m[K][o=P[e]]^=I,f.push(o);else if(rn>t)for(e=Math.max(_,t),u=rn;u>e;++e)m[K][o=P[e]]^=I,i.push(o);return _=n,rn=t,M.forEach(function(r){r(I,K,f,i)}),W}function c(r){return null==r?C():Array.isArray(r)?N(r):"function"==typeof r?S(r):A(r)}function A(r){return a((Y=s(z,r))(L))}function N(r){return a((Y=l(z,r))(L))}function C(){return a((Y=v)(L))}function S(r){return Y=v,R(V=r),_=0,rn=O,W}function R(r){var n,t,e,u=[],o=[];for(n=0;O>n;++n)!(m[K][t=P[n]]&I)^(e=r(L[n],t))&&(e?(m[K][t]&=J,u.push(t)):(m[K][t]|=I,o.push(t)));M.forEach(function(r){r(I,K,u,o)})}function j(r){for(var n,t=[],e=rn;--e>=_&&r>0;)m.zero(n=P[e])&&(t.push(w[n]),--r);return t}function B(r){for(var n,t=[],e=_;rn>e&&r>0;)m.zero(n=P[e])&&(t.push(w[n]),--r),e++;return t}function D(r){function t(n,t,u,o){function c(){++V===T&&(b=F(b,Q<<=1),R=F(R,Q),T=E(Q))}var s,l,v,p,y,d,g=S,b=x(V,T),k=D,z=H,A=V,U=0,N=0;for(Y&&(k=z=h),S=Array(V),V=0,R=A>1?q(R,O):x(O,T),A&&(v=(l=g[0]).key);o>N&&!((p=r(n[N]))>=p);)++N;for(;o>N;){for(l&&p>=v?(y=l,d=v,b[U]=V,(l=g[++U])&&(v=l.key)):(y={key:p,value:z()},d=p),S[V]=y;!(p>d||(R[s=t[N]+u]=V,m.zeroExcept(s,K,J)&&(y.value=k(y.value,w[s])),++N>=o));)p=r(n[N]);c()}for(;A>U;)S[b[U]=V]=g[U++],c();if(V>U)for(U=0;u>U;++U)R[U]=b[R[U]];s=M.indexOf(W),V>1?(W=e,X=i):(1===V?(W=f,X=a):(W=h,X=h),R=null),M[s]=W}function e(r,n,t,e){if(!(r===I&&n===K||Y)){var u,o,f,i;for(u=0,f=t.length;f>u;++u)m.zeroExcept(o=t[u],K,J)&&(i=S[R[o]],i.value=D(i.value,w[o]));for(u=0,f=e.length;f>u;++u)m.onlyExcept(o=e[u],K,J,n,r)&&(i=S[R[o]],i.value=G(i.value,w[o]))}}function f(r,n,t,e){if(!(r===I&&n===K||Y)){var u,o,f,i=S[0];for(u=0,f=t.length;f>u;++u)m.zeroExcept(o=t[u],K,J)&&(i.value=D(i.value,w[o]));for(u=0,f=e.length;f>u;++u)m.onlyExcept(o=e[u],K,J,n,r)&&(i.value=G(i.value,w[o]))}}function i(){var r,n;for(r=0;V>r;++r)S[r].value=H();for(r=0;O>r;++r)m.zeroExcept(r,K,J)&&(n=S[R[r]],n.value=D(n.value,w[r]))}function a(){var r,n=S[0];for(n.value=H(),r=0;O>r;++r)m.zeroExcept(r,K,J)&&(n.value=D(n.value,w[r]))}function c(){return Y&&(X(),Y=!1),S}function s(r){var n=j(c(),0,S.length,r);return B.sort(n,0,n.length)}function l(r,n,t){return D=r,G=n,H=t,Y=!0,C}function v(){return l(y,d,p)}function k(r){return l(g(r),b(r),p)}function z(r){function n(n){return r(n.value)}return j=o(n),B=u(n),C}function A(){return z(n)}function U(){return V}function N(){var r=M.indexOf(W);return r>=0&&M.splice(r,1),r=Z.indexOf(t),r>=0&&Z.splice(r,1),C}var C={top:s,all:c,reduce:l,reduceCount:v,reduceSum:k,order:z,orderNatural:A,size:U,remove:N};$.push(C);var S,R,j,B,D,G,H,Q=8,T=E(Q),V=0,W=h,X=h,Y=!0;return arguments.length<1&&(r=n),M.push(W),Z.push(t),t(L,P,0,O),v().orderNatural()}function G(){var r=D(h),n=r.all;return delete r.all,delete r.top,delete r.order,delete r.orderNatural,delete r.size,r.value=function(){return n()[0].value},r}function H(){$.forEach(function(r){r.remove()});var r=U.indexOf(e);for(r>=0&&U.splice(r,1),r=U.indexOf(f),r>=0&&U.splice(r,1),r=0;O>r;++r)m[K][r]&=J;return m.masks[K]&=J,W}var I,J,K,L,P,Q,T,V,W={filter:c,filterExact:A,filterRange:N,filterFunction:S,filterAll:C,top:j,bottom:B,group:D,groupAll:G,remove:H},X=i(function(r){return Q[r]}),Y=v,Z=[],$=[],_=0,rn=0;U.unshift(e),U.push(f);var nn=m.add();return K=nn.offset,I=nn.one,J=~I,e(w,0,O),f(w,0,O),W}function f(){function r(r,n){var t;if(!h)for(t=n;O>t;++t)m.zero(t)&&(a=c(a,w[t]))}function n(r,n,t,e){var u,o,f;if(!h){for(u=0,f=t.length;f>u;++u)m.zero(o=t[u])&&(a=c(a,w[o]));for(u=0,f=e.length;f>u;++u)m.only(o=e[u],n,r)&&(a=s(a,w[o]))}}function t(){var r;for(a=l(),r=0;O>r;++r)m.zero(r)&&(a=c(a,w[r]))}function e(r,n,t){return c=r,s=n,l=t,h=!0,v}function u(){return e(y,d,p)}function o(r){return e(g(r),b(r),p)}function f(){return h&&(t(),h=!1),a}function i(){var t=M.indexOf(n);return t>=0&&M.splice(t),t=U.indexOf(r),t>=0&&U.splice(t),v}var a,c,s,l,v={reduce:e,reduceCount:u,reduceSum:o,value:f,remove:i},h=!0;return M.push(n),U.push(r),r(w,0,O),u()}function a(){return O}var m,A={add:r,dimension:e,groupAll:f,size:a},w=[],O=0,M=[],U=[];return m=new c(0),arguments.length?r(arguments[0]):A}function x(r,n){return(257>n?N:65537>n?C:S)(r)}function k(r){for(var n=x(r,r),t=-1;++t<r;)n[t]=t;return n}function E(r){return 8===r?256:16===r?65536:4294967296}m.version="1.2.0",m.permute=t;var z=m.bisect=e(n);z.by=e;var A=m.heap=u(n);A.by=u;var w=m.heapselect=o(n);w.by=o;var O=m.insertionsort=f(n);O.by=f;var M=m.quicksort=i(n);M.by=i;var U=32,N=a,C=a,S=a,q=n,F=n;"undefined"!=typeof Uint8Array&&(N=function(r){return new Uint8Array(r)},C=function(r){return new Uint16Array(r)},S=function(r){return new Uint32Array(r)},q=function(r,n){var t=new r.constructor(n);return t.set(r),t},F=function(r,n){var t;switch(n){case 16:t=C(r.length);break;case 32:t=S(r.length);break;default:throw Error("invalid array width!")}return t.set(r),t}),c.prototype.lengthen=function(r){for(var n=0;n<this.subarrays;n++)this[n]=q(this[n],r)},c.prototype.add=function(){for(var r,n,t,e=0;e<this.subarrays;e++)if(r=this.masks[e],n=this.width-32*e,t=~r&-~r,!(n>=32)||t)return 32>n&&t&-(1<<n)&&(F(this[e],n<<=1),this.width=32*e+n),this.masks[e]|=t,{offset:e,one:t};return this[this.subarrays]=N(0),this.masks[this.subarrays]=1,this.width+=8,{offset:++this.subarrays,one:1}},c.prototype.zero=function(r){for(var n=0;n<this.subarrays;n++)if(this[n][r])return!1;return!0},c.prototype.zeroExcept=function(r,n,t){for(var e=0;e<this.subarrays;e++)if(e===n?this[e][r]&t:this[e][r])return!1;return!0},c.prototype.only=function(r,n,t){for(var e=0;e<this.subarrays;e++)if(this[e][r]!=(e===n?t:0))return!1;return!0},c.prototype.onlyExcept=function(r,n,t,e,u){for(var o,f=0;f<this.subarrays;f++)if(o=this[f][r],f===n&&(o&=t),o!=(f===e?u:0))return!1;return!0},r.crossfilter=m})(this);